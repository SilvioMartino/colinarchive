<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Post — Colin Archive</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Crimson+Text:wght@400;600&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root{
  --bg:#0b0b0c;
  --glass:rgba(255,255,255,0.04);
  --glass-border:rgba(255,255,255,0.08);
  --text:#eaeaea;
  --muted:#8a8a8a;
  --accent:#4ecdc4;
  --danger:#ff6b6b;
  --serif:'Crimson Text',serif;
  --mono:'IBM Plex Mono',monospace;
}

*{box-sizing:border-box;margin:0;padding:0;}

body{
  background:radial-gradient(circle at 20% 20%, #141414, #090909 60%);
  color:var(--text);
  font-family:var(--serif);
  min-height:100vh;
}

/* NAVBAR */

nav{
  backdrop-filter:blur(14px);
  background:var(--glass);
  border-bottom:1px solid var(--glass-border);
  padding:1.2rem 2rem;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.logo{
  font-family:var(--mono);
  font-size:.75rem;
  letter-spacing:.15em;
  text-transform:uppercase;
  color:var(--text);
  text-decoration:none;
}

.links a{
  font-family:var(--mono);
  font-size:.7rem;
  margin-left:2rem;
  text-decoration:none;
  color:var(--muted);
  transition:.25s;
}

.links a:hover{color:var(--accent);}

/* PAGE */

.wrapper{
  max-width:900px;
  margin:70px auto;
  padding:0 20px;
}

/* GLASS CARD */

.card{
  background:var(--glass);
  backdrop-filter:blur(18px);
  border:1px solid var(--glass-border);
  border-radius:18px;
  padding:3rem 3.5rem;
  box-shadow:0 20px 60px rgba(0,0,0,.35);
  animation:fadeUp .7s ease;
}

@keyframes fadeUp{
  from{opacity:0;transform:translateY(20px);}
  to{opacity:1;transform:translateY(0);}
}

/* TITLE */

.title{
  font-size:2.6rem;
  margin-bottom:1rem;
  line-height:1.25;
}

.meta{
  font-family:var(--mono);
  font-size:.75rem;
  color:var(--muted);
  margin-bottom:2rem;
  letter-spacing:.05em;
}

/* TAGS */

.tags{
  margin-bottom:2rem;
}

.tag{
  display:inline-block;
  border:1px solid var(--glass-border);
  padding:.25rem .7rem;
  margin:.2rem;
  font-family:var(--mono);
  font-size:.65rem;
  color:var(--muted);
  border-radius:6px;
}

/* EXCERPT */

.excerpt{
  font-size:1.3rem;
  color:#bdbdbd;
  margin-bottom:2.2rem;
  font-style:italic;
  border-left:3px solid var(--accent);
  padding-left:1rem;
}

/* CONTENT */

.content{
  font-size:1.18rem;
  line-height:1.85;
  white-space:pre-wrap;
}

/* LOCKED */

.locked{
  text-align:center;
  padding:3rem 2rem;
}

.locked h3{
  font-family:var(--mono);
  font-size:.8rem;
  letter-spacing:.1em;
  color:var(--danger);
  margin-bottom:1rem;
}

.locked p{
  color:var(--muted);
  margin-bottom:1.5rem;
}

.btn{
  display:inline-block;
  padding:.7rem 1.4rem;
  background:var(--danger);
  color:#000;
  font-family:var(--mono);
  font-size:.7rem;
  letter-spacing:.1em;
  text-decoration:none;
  border-radius:8px;
}

/* LOADING */

.loading{
  text-align:center;
  font-family:var(--mono);
  color:var(--muted);
}

/* MOBILE */

@media(max-width:700px){
  .card{padding:2rem;}
  .title{font-size:2rem;}
}
</style>
</head>

<body>

<nav>
<a href="/archive.html" class="logo">Colin Archive</a>
<div class="links">
<a href="/archive.html">Archive</a>
<a href="/write.html">Write</a>
</div>
</nav>

<div class="wrapper">
<div class="card" id="postBox">
<div class="loading">Loading post...</div>
</div>
</div>

<script>
const SUPABASE_URL="https://lbpkgvmxxcubzbzwoswd.supabase.co";
const SUPABASE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxicGtndm14eGN1Ynpiendvc3dkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEyNzM2OTQsImV4cCI6MjA4Njg0OTY5NH0.BaP0JY9v74qJPu9qRYoL1Mn3NWM3I-VB51dczOvxnrI";

const db=window.supabase.createClient(SUPABASE_URL,SUPABASE_KEY);

function id(){
 return new URLSearchParams(location.search).get("id");
}

async function load(){

 const {data,error}=await db
 .from("posts")
 .select("*")
 .eq("id",id())
 .single();

 if(error||!data){
 document.getElementById("postBox").innerHTML="<div class='loading'>Post not found</div>";
 return;
 }

 render(data);
}

function render(p){

 const tags=(p.tags||"").split(",").filter(Boolean)
 .map(t=>`<span class="tag">${escape(t.trim())}</span>`).join("");

 if(p.access==="paid"){
 document.getElementById("postBox").innerHTML=`
 <h1 class="title">${escape(p.title)}</h1>
 <div class="meta">${new Date(p.created_at).toLocaleDateString()} • ${p.readtime||1} min read</div>
 ${tags?`<div class="tags">${tags}</div>`:""}
 ${p.excerpt?`<div class="excerpt">${escape(p.excerpt)}</div>`:""}
 <div class="locked">
 <h3>PAID ENTRY</h3>
 <p>This post requires access.</p>
 <a class="btn" href="#">Unlock</a>
 </div>`;
 return;
 }

 document.getElementById("postBox").innerHTML=`
 <h1 class="title">${escape(p.title)}</h1>
 <div class="meta">${new Date(p.created_at).toLocaleDateString()} • ${p.readtime||1} min read</div>
 ${tags?`<div class="tags">${tags}</div>`:""}
 ${p.excerpt?`<div class="excerpt">${escape(p.excerpt)}</div>`:""}
 <div class="content">${escape(p.content)}</div>
 `;
}

function escape(s){
 return s.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");
}

load();
</script>

</body>
</html>
