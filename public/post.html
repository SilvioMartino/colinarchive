<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<title>Post — Colin Archive</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Crimson+Text:ital,wght@0,400;0,600;1,400&family=IBM+Plex+Mono:wght@400;500&family=Caveat:wght@400;600&display=swap" rel="stylesheet">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root{
  --bg:#0d0d0d;
  --paper:#1a1a1a;
  --fg:#e8e8e8;
  --muted:#8a8a8a;
  --border:#2a2a2a;
  --blue:#4ecdc4;
  --red:#ff6b6b;
  --serif:'Crimson Text',serif;
  --mono:'IBM Plex Mono',monospace;
  --hand:'Caveat',cursive;
}

*{box-sizing:border-box;margin:0;padding:0;}

body{
  background:var(--bg);
  color:var(--fg);
  font-family:var(--serif);
  line-height:1.8;
}

/* subtle grain overlay */
body::after{
  content:"";
  position:fixed;
  inset:0;
  background-image:url("https://grainy-gradients.vercel.app/noise.svg");
  opacity:.04;
  pointer-events:none;
}

/* header */
header{
  padding:1.5rem 2rem;
  border-bottom:1px solid var(--border);
  background:var(--paper);
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.logo{
  font-family:var(--mono);
  font-size:.75rem;
  letter-spacing:.15em;
  text-transform:uppercase;
  color:var(--fg);
  text-decoration:none;
}

.nav a{
  margin-left:1.5rem;
  font-family:var(--mono);
  font-size:.7rem;
  color:var(--muted);
  text-decoration:none;
  letter-spacing:.1em;
}

.nav a:hover{color:var(--blue);}

/* layout grid */
.layout{
  display:grid;
  grid-template-columns:1fr minmax(0,700px) 280px 1fr;
  padding:3rem 1rem;
}

/* article */
.article{
  grid-column:2;
}

.title{
  font-size:2.6rem;
  margin-bottom:.6rem;
  line-height:1.2;
}

.meta{
  font-family:var(--mono);
  font-size:.75rem;
  color:var(--muted);
  margin-bottom:2rem;
}

.content p{
  margin:1.4rem 0;
  transition:.25s;
}

.content p:hover{
  background:rgba(78,205,196,.06);
}

/* margin notes */
.margin{
  grid-column:3;
  padding-left:2rem;
}

.note{
  font-family:var(--hand);
  font-size:1rem;
  color:var(--blue);
  margin-bottom:1.5rem;
  opacity:.9;
  transform:rotate(-1deg);
  transition:.3s;
}

.note.hidden{
  opacity:0;
  transform:translateY(10px);
}

/* tags */
.tags{
  margin-top:2rem;
}

.tag{
  display:inline-block;
  border:1px solid var(--border);
  padding:.2rem .7rem;
  margin:.3rem;
  font-family:var(--mono);
  font-size:.65rem;
  color:var(--muted);
}

.tag:hover{
  border-color:var(--blue);
  color:var(--blue);
}

.loading{
  text-align:center;
  margin-top:120px;
  font-family:var(--mono);
  color:var(--muted);
}

/* mobile */
@media(max-width:900px){
  .layout{
    grid-template-columns:1fr;
  }
  .margin{
    display:none;
  }
}
</style>

</head>

<body>

<header>
<a href="/archive.html" class="logo">Colin Archive</a>
<div class="nav">
<a href="/archive.html">Archive</a>
<a href="/write.html">Write</a>
</div>
</header>

<div class="layout">

<div class="article" id="article">
<div class="loading">Loading entry...</div>
</div>

<div class="margin" id="margin"></div>

</div>

<script>
const SUPABASE_URL="https://lbpkgvmxxcubzbzwoswd.supabase.co";
const SUPABASE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxicGtndm14eGN1Ynpiendvc3dkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEyNzM2OTQsImV4cCI6MjA4Njg0OTY5NH0.BaP0JY9v74qJPu9qRYoL1Mn3NWM3I-VB51dczOvxnrI"; // ← paste anon key here

const db=window.supabase.createClient(SUPABASE_URL,SUPABASE_KEY);

function getID(){
  return new URLSearchParams(location.search).get("id");
}

function escapeHTML(str){
  return str.replace(/[&<>]/g,m=>({ "&":"&amp;","<":"&lt;",">":"&gt;" }[m]));
}

async function load(){

  const id=getID();
  if(!id){
    document.getElementById("article").innerHTML="<h2>No post id</h2>";
    return;
  }

  const {data,error}=await db
    .from("posts")
    .select("*")
    .eq("id",id)
    .maybeSingle();

  if(error||!data){
    document.getElementById("article").innerHTML="<h2>Post not found</h2>";
    return;
  }

  render(data);
}

function render(post){

  const paragraphs = escapeHTML(post.content).split(/\n+/);

  document.title=post.title+" — Colin Archive";

  document.getElementById("article").innerHTML=`
    <h1 class="title">${post.title}</h1>
    <div class="meta">${new Date(post.created_at).toLocaleDateString()} · ${post.readtime||1} min read</div>
    <div class="content">
      ${paragraphs.map(p=>`<p>${p}</p>`).join("")}
    </div>
    <div class="tags">
      ${(post.tags||"").split(",").map(t=>`<span class="tag">${t.trim()}</span>`).join("")}
    </div>
  `;

  generateNotes();
}

function generateNotes(){

  const paragraphs=document.querySelectorAll(".content p");
  const margin=document.getElementById("margin");

  paragraphs.forEach(p=>{

    if(Math.random()>.55)return;

    const note=document.createElement("div");
    note.className="note hidden";
    note.innerText=randomNote();

    margin.appendChild(note);

    p.addEventListener("mouseenter",()=>note.classList.remove("hidden"));
    p.addEventListener("mouseleave",()=>note.classList.add("hidden"));
  });
}

function randomNote(){
  const notes=[
    "interesting…",
    "expand this later",
    "this matters",
    "question this",
    "rewrite?",
    "keep.",
    "too honest?",
    "important idea",
    "note to self"
  ];
  return notes[Math.floor(Math.random()*notes.length)];
}

load();
</script>

</body>
</html>
