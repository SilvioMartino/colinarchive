<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Post ‚Äî Colin Archive</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="A quiet archive of essays, code, and notes ‚Äì unfiltered and unpolished." />

  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:wght@400;600&family=IBM+Plex+Mono:ital,wght@0,300;0,400;0,500;1,400&family=Caveat:wght@400;600&family=Libre+Baskerville:wght@400;700&family=JetBrains+Mono:wght@300;400;500&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    :root {
      --bg:       #0b0b0b;
      --surface:  #111111;
      --raised:   #161616;
      --border:   #222222;
      --border-l: #2e2e2e;
      --fg:       #ede9e0;
      --fg-2:     #c8c3b8;
      --fg-3:     #888078;
      --red:      #e8524a;
      --blue:     #3ecfcb;
      --green:    #4dcc6a;
      --yellow:   #f0d060;
      --serif:    'Libre Baskerville', 'Georgia', serif;
      --body:     'Crimson Text', serif;
      --mono:     'IBM Plex Mono', monospace;
      --code:     'JetBrains Mono', 'IBM Plex Mono', monospace;
      --hand:     'Caveat', cursive;

      /* Terminal palette */
      --term-bg:      #0d0f0d;
      --term-surface: #111411;
      --term-border:  #1e221e;
      --term-border-l:#2a302a;
      --term-gutter:  #0a0c0a;
      --term-green:   #4dcc6a;
      --term-green-d: #2a6b3a;
      --term-green-b: #7fffaa;
      --term-comment: #3d5c42;
      --term-string:  #88d4ab;
      --term-keyword: #5fd4bc;
      --term-number:  #c8e87a;
      --term-fn:      #a8d888;
      --term-muted:   #3a4a3e;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background: var(--bg);
      color: var(--fg);
      font-family: var(--body);
      min-height: 100vh;
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
    }

    /* Noise */
    body::after {
      content: '';
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 9999;
      opacity: 0.02;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
      background-size: 180px;
    }

    /* ‚îÄ‚îÄ NAV ‚îÄ‚îÄ */
    nav {
      background: rgba(11,11,11,0.92);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border-bottom: 1px solid var(--border);
      padding: 0 3rem;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 100;
      transition: border-bottom-color 0.3s, box-shadow 0.3s;
    }

    nav.nav-type-essay  { border-bottom: 2px solid var(--blue);   box-shadow: 0 1px 20px rgba(62,207,203,0.08); }
    nav.nav-type-code   { border-bottom: 2px solid var(--green);  box-shadow: 0 1px 20px rgba(77,204,106,0.08); }
    nav.nav-type-notes  { border-bottom: 2px solid var(--yellow); box-shadow: 0 1px 20px rgba(240,208,96,0.08); }

    .nav-left { display: flex; align-items: center; gap: 1.5rem; }

    .logo {
      font-family: var(--mono);
      font-size: 0.7rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      font-weight: 400;
      text-decoration: none;
      color: var(--fg);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .logo-dot {
      width: 6px; height: 6px;
      background: var(--red);
      border-radius: 50%;
      animation: pulse 2s ease-in-out infinite;
    }
    @keyframes pulse {
      0%,100% { opacity: 1; transform: scale(1); }
      50%      { opacity: 0.4; transform: scale(0.7); }
    }

    .post-type-badge {
      font-family: var(--mono);
      font-size: 0.55rem;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      padding: 0.25rem 0.65rem;
      border: 1px solid currentColor;
    }
    .post-type-badge.essay  { color: var(--blue); }
    .post-type-badge.code   { color: var(--green); }
    .post-type-badge.notes  { color: var(--yellow); }

    .nav-right { display: flex; align-items: center; gap: 1.5rem; }
    .nav-back {
      font-family: var(--mono);
      font-size: 0.6rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--fg-3);
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      transition: color 0.2s, gap 0.2s;
    }
    .nav-back:hover { color: var(--fg); gap: 0.75rem; }

    /* ‚îÄ‚îÄ WRAPPER ‚îÄ‚îÄ */
    .wrapper {
      max-width: 860px;
      margin: 0 auto;
      padding: 4rem 3rem 6rem;
    }

    /* ‚îÄ‚îÄ POST HEADER ‚îÄ‚îÄ */
    .post-header { margin-bottom: 3rem; }

    .post-overline {
      font-family: var(--mono);
      font-size: 0.58rem;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: var(--fg-3);
      margin-bottom: 1.25rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }
    .post-overline::before { content: ''; width: 20px; height: 1px; background: var(--fg-3); }

    .title {
      font-family: var(--serif);
      font-size: clamp(2rem, 4vw, 3rem);
      font-weight: 700;
      line-height: 1.15;
      letter-spacing: -0.02em;
      margin-bottom: 1rem;
      color: var(--fg);
    }
    .type-code .title { font-family: var(--code); font-size: clamp(1.6rem, 3vw, 2.2rem); letter-spacing: -0.03em; }
    .type-notes .title { font-family: var(--hand); font-size: clamp(2rem, 4vw, 2.8rem); letter-spacing: 0; }

    .post-meta {
      display: flex;
      align-items: center;
      gap: 1.5rem;
      flex-wrap: wrap;
      margin-bottom: 1.5rem;
    }
    .post-meta-item {
      font-family: var(--mono);
      font-size: 0.58rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--fg-3);
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }
    .post-meta-item i { font-size: 0.6rem; }

    .post-meta-sep { width: 3px; height: 3px; background: var(--border-l); border-radius: 50%; }

    .tags { display: flex; flex-wrap: wrap; gap: 0.4rem; }
    .tag {
      font-family: var(--mono);
      font-size: 0.55rem;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--fg-3);
      border: 1px solid var(--border);
      padding: 0.2rem 0.65rem;
      transition: border-color 0.2s, color 0.2s;
    }
    .tag:hover { border-color: var(--blue); color: var(--blue); }

    /* Post excerpt (pull quote) */
    .post-excerpt {
      font-family: var(--body);
      font-size: 1.25rem;
      font-style: italic;
      color: var(--fg-2);
      line-height: 1.7;
      border-left: 2px solid var(--border-l);
      padding-left: 1.25rem;
      margin: 2rem 0;
    }
    .type-essay .post-excerpt { border-left-color: var(--blue); }
    .type-notes .post-excerpt { border-left-color: var(--yellow); }

    /* ‚îÄ‚îÄ BODY CONTENT (essays/notes) ‚îÄ‚îÄ */
    .content {
      font-size: 1.15rem;
      line-height: 1.9;
      color: var(--fg-2);
      white-space: pre-wrap;
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       TERMINAL ‚Äî CODE POSTS
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    .terminal-wrap {
      position: relative;
      border-radius: 10px;
      overflow: hidden;
      border: 1px solid var(--term-border);
      box-shadow:
        0 0 0 1px rgba(77,204,106,0.04),
        0 20px 60px rgba(0,0,0,0.6),
        0 4px 16px rgba(0,0,0,0.4),
        inset 0 0 40px rgba(77,204,106,0.02);
    }

    /* Subtle green ambient glow behind terminal */
    .terminal-wrap::before {
      content: '';
      position: absolute;
      inset: -40px;
      background: radial-gradient(ellipse 60% 40% at 50% 0%, rgba(77,204,106,0.06) 0%, transparent 70%);
      pointer-events: none;
      z-index: 0;
    }

    /* ‚îÄ‚îÄ TITLEBAR ‚îÄ‚îÄ */
    .term-titlebar {
      position: relative;
      z-index: 2;
      background: var(--term-surface);
      border-bottom: 1px solid var(--term-border);
      padding: 0 1rem;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }

    .term-controls {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .term-btn {
      width: 12px; height: 12px;
      border-radius: 50%;
      position: relative;
      cursor: default;
      transition: filter 0.15s;
    }
    .term-btn:hover { filter: brightness(1.2); }
    .term-btn-close   { background: #ff5f57; box-shadow: 0 0 6px rgba(255,95,87,0.4); }
    .term-btn-min     { background: #ffbd2e; box-shadow: 0 0 6px rgba(255,189,46,0.4); }
    .term-btn-max     { background: #28c840; box-shadow: 0 0 6px rgba(40,200,64,0.4); }
    /* Icons on hover */
    .term-btn::after {
      content: '';
      position: absolute;
      inset: 3px;
      background: rgba(0,0,0,0.35);
      border-radius: 50%;
      opacity: 0;
      transition: opacity 0.15s;
    }
    .term-btn:hover::after { opacity: 1; }

    .term-title-center {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      font-family: var(--code);
      font-size: 0.6rem;
      font-weight: 300;
      letter-spacing: 0.08em;
      color: var(--term-muted);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .term-title-icon { color: var(--term-green-d); }

    .term-titlebar-right {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }


    /* Copy button */
    .copy-btn {
      display: flex;
      align-items: center;
      gap: 0.35rem;
      font-family: var(--code);
      font-size: 0.55rem;
      font-weight: 400;
      letter-spacing: 0.1em;
      text-transform: uppercase;
      color: var(--term-green-d);
      background: transparent;
      border: 1px solid var(--term-border-l);
      padding: 0.25rem 0.65rem;
      cursor: pointer;
      border-radius: 3px;
      transition: background 0.2s, border-color 0.2s, color 0.2s;
    }
    .copy-btn:hover { background: rgba(77,204,106,0.06); border-color: var(--term-green-d); color: var(--term-green); }
    .copy-btn.copied { background: rgba(77,204,106,0.1); border-color: var(--term-green); color: var(--term-green-b); }
    .copy-btn i { font-size: 0.6rem; }


    /* ‚îÄ‚îÄ STATUSBAR ‚îÄ‚îÄ */
    .term-statusbar {
      position: relative;
      z-index: 2;
      background: var(--term-surface);
      border-top: 1px solid var(--term-border);
      padding: 0.35rem 1.25rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }
    .term-status-left, .term-status-right {
      display: flex;
      align-items: center;
      gap: 1.25rem;
    }
    .term-status-item {
      font-family: var(--code);
      font-size: 0.52rem;
      font-weight: 300;
      letter-spacing: 0.08em;
      color: var(--term-muted);
      display: flex;
      align-items: center;
      gap: 0.35rem;
    }
    .term-status-item i { font-size: 0.5rem; }
    .term-status-item.active { color: var(--term-green-d); }
    .term-status-branch { color: var(--term-green-d); }
    .term-status-ok { color: var(--term-green); }
    .term-status-indicator {
      width: 6px; height: 6px;
      border-radius: 50%;
      background: var(--term-green);
      box-shadow: 0 0 5px var(--term-green);
      animation: blink-status 3s ease-in-out infinite;
    }
    @keyframes blink-status {
      0%,80%,100% { opacity: 1; }
      90% { opacity: 0.2; }
    }

    /* ‚îÄ‚îÄ CODE BODY ‚îÄ‚îÄ */
    .term-body {
      position: relative;
      z-index: 1;
      background: var(--term-bg);
      overflow-x: auto;
      overflow-y: visible;
    }
    .term-body::-webkit-scrollbar { height: 6px; }
    .term-body::-webkit-scrollbar-track { background: var(--term-gutter); }
    .term-body::-webkit-scrollbar-thumb { background: var(--term-border-l); border-radius: 3px; }
    .term-body::-webkit-scrollbar-thumb:hover { background: var(--term-green-d); }

    /* Table keeps number + line in the same row ‚Äî they can never drift */
    .term-table {
      display: table;
      border-collapse: collapse;
      min-width: 100%;
      padding: 1rem 0;
    }
    .term-row {
      display: table-row;
    }
    .term-row:hover .term-ln { color: var(--term-green-d); }
    .term-row:hover .code-line { background: rgba(77,204,106,0.025); }

    .term-ln {
      display: table-cell;
      font-family: var(--code);
      font-size: 0.8rem;
      font-weight: 300;
      line-height: 1.7;
      color: var(--term-muted);
      background: var(--term-gutter);
      border-right: 1px solid var(--term-border);
      text-align: right;
      padding: 0 0.9rem 0 0.75rem;
      user-select: none;
      white-space: nowrap;
      vertical-align: top;
      transition: color 0.1s;
    }

    .code-line {
      display: table-cell;
      font-family: var(--code);
      font-size: 0.82rem;
      font-weight: 400;
      line-height: 1.7;
      white-space: pre;
      color: #9ecb9e;
      letter-spacing: 0.01em;
      padding: 0 1.5rem;
      vertical-align: top;
      width: 100%;
      transition: background 0.1s;
    }

    .code-line {
      display: block;
      font-family: var(--code);
      font-size: 0.82rem;
      font-weight: 400;
      line-height: 1.7;
      white-space: pre;
      color: #9ecb9e;
      letter-spacing: 0.01em;
    }

    /* Basic syntax highlighting */
    .tok-kw     { color: var(--term-keyword); font-weight: 500; }   /* keywords */
    .tok-str    { color: var(--term-string); }                        /* strings */
    .tok-num    { color: var(--term-number); }                        /* numbers */
    .tok-cmt    { color: var(--term-comment); font-style: italic; }  /* comments */
    .tok-fn     { color: var(--term-fn); }                            /* functions */
    .tok-op     { color: #7ab87a; }                                   /* operators */
    .tok-punct  { color: #5a7a5a; }                                   /* punctuation */

    /* Highlight on hover */
    .code-line:hover { background: rgba(77,204,106,0.025); }

    /* Cursor blink in last line */
    .term-cursor {
      display: inline-block;
      width: 7px;
      height: 0.9em;
      background: var(--term-green);
      vertical-align: text-bottom;
      margin-left: 2px;
      animation: cursor-blink 1.1s step-end infinite;
      box-shadow: 0 0 6px var(--term-green);
    }
    @keyframes cursor-blink {
      0%,50% { opacity: 1; }
      51%,100% { opacity: 0; }
    }

    /* ‚îÄ‚îÄ LOCKED POST ‚îÄ‚îÄ */
    .locked-message {
      border: 1px solid rgba(232,82,74,0.3);
      padding: 3rem 2rem;
      text-align: center;
      position: relative;
      background: repeating-linear-gradient(
        -45deg,
        rgba(139,0,20,0.06) 0px, rgba(139,0,20,0.06) 8px,
        transparent 8px, transparent 18px
      );
      margin-top: 2rem;
    }
    .locked-message h3 {
      font-family: var(--mono);
      font-size: 0.7rem;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--red);
      margin-bottom: 0.75rem;
    }
    .locked-message p { color: var(--fg-3); margin-bottom: 1.5rem; font-size: 0.95rem; }
    .btn {
      font-family: var(--mono);
      font-size: 0.6rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--red);
      border: 1px solid var(--red);
      padding: 0.65rem 1.75rem;
      text-decoration: none;
      display: inline-block;
      transition: background 0.2s, color 0.2s;
    }
    .btn:hover { background: var(--red); color: #fff; }

    /* Loading */
    .loading {
      padding: 5rem 0;
      text-align: center;
      font-family: var(--mono);
      font-size: 0.65rem;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--fg-3);
    }

    /* ‚îÄ‚îÄ MOBILE ‚îÄ‚îÄ */
    @media (max-width: 700px) {
      nav { padding: 0 1.5rem; }
      .wrapper { padding: 2.5rem 1.25rem 4rem; }
      .title { font-size: 1.8rem; }
      .term-titlebar { padding: 0 0.75rem; }
      .term-title-center { display: none; }
      .term-statusbar { display: none; }
      .code-line { font-size: 0.72rem; }
      .term-gutter-col { min-width: 38px; }
      .term-gutter-col span { font-size: 0.7rem; padding-right: 0.6rem; }
    }

    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after { animation: none !important; transition: none !important; }
    }
  </style>
</head>
<body>

<nav id="mainNav">
  <div class="nav-left">
    <a href="/" class="logo">
      <span class="logo-dot"></span>
      Colin Archive
    </a>
    <span class="post-type-badge" id="postTypeBadge"></span>
  </div>
  <div class="nav-right">
    <a href="/" class="nav-back">‚Üê Back</a>
  </div>
</nav>

<div class="wrapper">
  <div id="postContainer">
    <div class="loading">Loading post...</div>
  </div>
</div>

<script>
  const SUPABASE_URL = "https://lbpkgvmxxcubzbzwoswd.supabase.co";
  const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxicGtndm14eGN1Ynpiendvc3dkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEyNzM2OTQsImV4cCI6MjA4Njg0OTY5NH0.BaP0JY9v74qJPu9qRYoL1Mn3NWM3I-VB51dczOvxnrI";
  const db = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

  const nav       = document.getElementById('mainNav');
  const typeBadge = document.getElementById('postTypeBadge');
  const container = document.getElementById('postContainer');

  function getPostId() {
    return new URLSearchParams(location.search).get("id");
  }

  function escapeHtml(s) {
    if (!s) return '';
    return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')
            .replace(/"/g,'&quot;').replace(/'/g,'&#039;');
  }

  function normalizeIndent(text) {
    const lines = text.split('\n');
    let min = Infinity;
    lines.forEach(l => { if (l.trim()) { const m = l.match(/^(\s*)/); min = Math.min(min, m[0].length); } });
    if (min === Infinity) min = 0;
    return lines.map(l => l.slice(min)).join('\n');
  }

  // Basic syntax highlighter ‚Äî colour-codes common patterns
  function highlight(line) {
    // Already escaped. Apply token spans by pattern matching on escaped text.
    // Order matters: comments first, then strings, then keywords, then numbers.
    let s = line;

    // Comments: // ... or # ...
    s = s.replace(/^([ \t]*)(\/\/.*|#.*)$/, '$1<span class="tok-cmt">$2</span>');

    // Strings: "..." or '...' or `...`
    s = s.replace(/(&quot;(?:[^&]|&(?!quot;))*&quot;|&#039;(?:[^&]|&(?!#039;))*&#039;|`[^`]*`)/g,
      '<span class="tok-str">$1</span>');

    // Keywords
    const kw = /\b(const|let|var|function|return|if|else|for|while|do|switch|case|break|continue|class|new|import|export|default|from|async|await|try|catch|finally|throw|typeof|instanceof|void|delete|in|of|true|false|null|undefined|this|super|extends|static|get|set|def|print|pass|and|or|not|with|as|yield|lambda|elif|except|raise|import|from|global|nonlocal|int|str|float|bool|list|dict|tuple|set)\b/g;
    s = s.replace(kw, '<span class="tok-kw">$1</span>');

    // Numbers
    s = s.replace(/\b(\d+\.?\d*)\b/g, '<span class="tok-num">$1</span>');

    // Function calls: word followed by (
    s = s.replace(/\b([a-zA-Z_]\w*)(?=\s*\()/g, '<span class="tok-fn">$1</span>');

    return s;
  }



  async function loadPost() {
    const id = getPostId();
    if (!id) { container.innerHTML = "<div class='loading'>No post ID specified</div>"; return; }
    const { data, error } = await db.from("posts").select("*").eq("id", id).single();
    if (error || !data) { container.innerHTML = "<div class='loading'>Post not found</div>"; return; }
    renderPost(data);
  }

  function renderPost(post) {
    const type   = post.type || 'essay';
    const isPaid = post.access === 'paid';
    const date   = new Date(post.created_at).toLocaleDateString('en-US', { year:'numeric', month:'long', day:'numeric' });
    const rt     = post.readtime || 1;
    const tags   = (post.tags||'').split(',').filter(Boolean)
                    .map(t => `<span class="tag">${escapeHtml(t.trim())}</span>`).join('');
    const label  = type === 'code' ? 'Code' : type === 'notes' ? 'Note' : 'Essay';

    // Nav
    nav.classList.add(`nav-type-${type}`);
    typeBadge.className = `post-type-badge ${type}`;
    typeBadge.textContent = label;

    const overline = `<div class="post-overline">${label} ‚Äî ${date}</div>`;
    const titleEl  = `<h1 class="title">${escapeHtml(post.title)}</h1>`;
    const metaEl   = `
      <div class="post-meta">
        <span class="post-meta-item"><i class="far fa-clock"></i>${rt} min read</span>
        <span class="post-meta-sep"></span>
        <span class="post-meta-item"><i class="far fa-calendar"></i>${date}</span>
        ${isPaid ? `<span class="post-meta-sep"></span><span class="post-meta-item" style="color:var(--red)"><i class="fas fa-lock"></i>Paid</span>` : ''}
      </div>`;
    const excerptEl = '';
    const tagsEl = tags ? `<div class="tags">${tags}</div>` : '';

    let bodyHtml = '';

    if (isPaid) {
      bodyHtml = `
        <div class="locked-message">
          <h3>üîí Paid Entry</h3>
          <p>This post is part of the paid archive.</p>
          <a class="btn" href="#">Unlock Access</a>
        </div>`;
    } else if (type === 'code') {
      const raw  = normalizeIndent(post.content || '');
      const lines = raw.split('\n');

      // Remove trailing empty lines
      while (lines.length && !lines[lines.length-1].trim()) lines.pop();

      const gutterHtml = lines.map((_, i) =>
        `<span id="ln${i+1}">${i+1}</span>`
      ).join('');

      const codeHtml = lines.map((line, i) => {
        const escaped = escapeHtml(line || ' ');
        const highlighted = highlight(escaped);
        const cursor = i === lines.length - 1 ? '<span class="term-cursor"></span>' : '';
        return `<span class="code-line" data-line="${i+1}">${highlighted}${cursor}</span>`;
      }).join('');

      bodyHtml = `
        <div class="terminal-wrap">

          <!-- Titlebar -->
          <div class="term-titlebar">
            <div class="term-controls">
              <span class="term-btn term-btn-close"></span>
              <span class="term-btn term-btn-min"></span>
              <span class="term-btn term-btn-max"></span>
            </div>
            <div class="term-title-center">
              <i class="fas fa-code term-title-icon"></i>
              ${escapeHtml(post.title)}
            </div>
            <div class="term-titlebar-right">
              <button class="copy-btn" id="copyBtn">
                <i class="far fa-copy"></i> Copy
              </button>
            </div>
          </div>

          <!-- Code body -->
          <div class="term-body">
            <div class="term-gutter-col" id="termGutter">${gutterHtml}</div>
            <div class="term-code" id="termCode">${codeHtml}</div>
          </div>

          <!-- Status bar -->
          <div class="term-statusbar">
            <div class="term-status-left">
              <span class="term-status-item term-status-branch">
                <i class="fas fa-code-branch"></i> main
              </span>
              <span class="term-status-item term-status-ok">
                <i class="fas fa-check-circle"></i> No errors
              </span>
              <span class="term-status-item">
                <i class="fas fa-align-left"></i> ${lines.length} lines
              </span>
            </div>
            <div class="term-status-right">
              <span class="term-status-item">UTF-8</span>
              <span class="term-status-item">Spaces: 2</span>
            </div>
          </div>

        </div>`;
    } else {
      bodyHtml = `<div class="content">${escapeHtml(post.content || '')}</div>`;
    }

    container.innerHTML = `
      <div class="type-${type}">
        <div class="post-header">
          ${overline}
          ${titleEl}
          ${metaEl}
          ${tagsEl}
          ${excerptEl}
        </div>
        ${bodyHtml}
      </div>`;

    // Copy button
    if (type === 'code' && !isPaid) {
      const btn = document.getElementById('copyBtn');
      const raw = normalizeIndent(post.content || '');
      if (btn) {
        btn.addEventListener('click', async () => {
          try {
            await navigator.clipboard.writeText(raw);
            btn.classList.add('copied');
            btn.innerHTML = '<i class="fas fa-check"></i> Copied!';
            setTimeout(() => {
              btn.classList.remove('copied');
              btn.innerHTML = '<i class="far fa-copy"></i> Copy';
            }, 2000);
          } catch(e) { console.error(e); }
        });
      }

      // Highlight active line number on hover
      const codeLines = document.querySelectorAll('.code-line');
      const gutter    = document.getElementById('termGutter');
      codeLines.forEach(line => {
        line.addEventListener('mouseenter', () => {
          const n = line.dataset.line;
          gutter.querySelectorAll('span').forEach(s => s.classList.remove('active'));
          const span = gutter.querySelector(`#ln${n}`);
          if (span) span.classList.add('active');
        });
        line.addEventListener('mouseleave', () => {
          gutter.querySelectorAll('span').forEach(s => s.classList.remove('active'));
        });
      });
    }
  }

  loadPost();
</script>

</body>
</html>
